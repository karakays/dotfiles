# Set TPM plugin directory explicitly
set -g @tpm_log_level 'debug'
set-environment -g TMUX_PLUGIN_MANAGER_PATH "$HOME/.config/tmux/plugins"

# Enable 256 colors and true color support
set-option -g default-terminal "tmux-256color"
set -ga terminal-overrides ",xterm-256color:RGB"
set-option -g history-limit 100000
set-option -g mode-keys vi
set-option -g base-index 1
set-option -g renumber-windows on

# bind mouse events
set-option -g mouse on
set-option -s set-clipboard off

# unbind default keys for custom bindings
unbind o
unbind ,
unbind .
unbind %
unbind \"
unbind f
unbind i

# prefix
unbind C-b
set-option -g prefix C-b
bind-key C-b send-prefix

# pane options

# next/previous pane (cycle)
bind C-b select-pane -t :.+
bind h select-pane -L
bind j select-pane -D 
bind k select-pane -U
bind l select-pane -R

bind o kill-pane -a
bind [ select-pane -l

# split panes from working directory
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"

# window options

# new-window from working directory
bind c new-window -c "#{pane_current_path}"

# next/previous window
bind n select-window -n
bind p select-window -p
# 0 is always the first window
bind 0 select-window -t:\^
# 9 is always the last window
bind 9 select-window -t:\$
# go to last window
bind - select-window -t:!

# sesh - fuzzy session/project switcher with instant filtering
bind f display-popup -E -w 80% -h 80% "\
  sesh list | fzf \
    --ansi \
    --no-sort \
    --border-label ' sesh ' \
    --prompt '‚ö°  ' \
    --header '  ^t tmux  ^x zoxide  ^k kill' \
    --bind 'ctrl-t:change-prompt(ü™ü  )+reload(sesh list -t)' \
    --bind 'ctrl-x:change-prompt(üìÅ  )+reload(sesh list -z)' \
    --bind 'ctrl-k:execute-silent(tmux kill-session -t {})' \
  | xargs sesh connect"

# source config
bind r source-file $ZSH_TMUX_CONFIG\; display-message "Reloaded!"

# enter copy-mode
unbind [
bind Space copy-mode

# rename windows to show directory and process
set-option -g automatic-rename on
# format: directory:command (~ for home directory)
set-option -g automatic-rename-format '#{?#{==:#{pane_current_path},#{HOME}},~,#{b:pane_current_path}}:#{pane_current_command}'

# show process name on pane borders
set -g pane-border-status top
set -g pane-border-format " #{pane_index} #{pane_current_command} "

# window notifications - enhanced with better visibility
set-window-option -g monitor-activity on
set-option -g visual-activity both                    # Show message AND bell
set-option -g activity-action other                   # Only for non-current windows
set-option -g display-time 1000                       # Show for 1 second
# Show window name in notifications instead of index
set-hook -g alert-activity 'display-message "Activity: #{window_name}"'

# copy-mode bindings
bind-key -T copy-mode-vi v send-keys -X begin-selection
bind-key -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind-key -T copy-mode-vi Escape send-keys -X clear-selection

# tmux-yank: stay in copy mode after yanking, keep cursor position
set -g @yank_action 'copy-pipe-no-clear'

# List of plugins
set -g @tpm_plugins '			\
	tmux-plugins/tpm		    \
	tmux-plugins/tmux-sensible	\
	tmux-plugins/tmux-yank		\
	Morantron/tmux-fingers		\
	tmux-plugins/tmux-open		\
	egel/tmux-gruvbox		    \
	jimeh/tmux-themepack		\
	rickstaa/tmux-notify		\
'
set -g @tmux-gruvbox 'dark256'

# Customize gruvbox status-right sections
set -g @tmux-gruvbox-right-status-x "NY #(TZ=America/New_York date '+%%H:%%M %%Z')"
set -g @tmux-gruvbox-right-status-y "UK #(TZ=Europe/London date '+%%H:%%M %%Z')"
set -g @tmux-gruvbox-right-status-z "TR #(TZ=Europe/Istanbul date '+%%H:%%M %%Z') #{tmux_mode_indicator}"

run-shell '~/.config/tmux/plugins/tpm/tpm'

# Override theme with custom message style (must be after plugins load)
set -g message-style "bg=colour167,fg=colour231,bold"
set -g message-command-style "bg=colour167,fg=colour231,bold"

# Transparent status bar (overrides gruvbox theme)
#set -g status-style "bg=default"
#set -g status-left-style "bg=default"
#set -g status-right-style "bg=default"

